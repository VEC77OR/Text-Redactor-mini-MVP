# Имя виртуального окружения
VENV = venv
PYTHON = $(VENV)/bin/python
PIP = $(VENV)/bin/pip

# ------------------------------
# Создать venv
# ------------------------------
venv:
	python3 -m venv $(VENV)
	@echo "Виртуальное окружение создано."

# ------------------------------
# Установить зависимости
# ------------------------------
install: venv
	$(PIP) install --upgrade pip
	$(PIP) install -r requirements.txt
	@echo "Все зависимости установлены."

# ------------------------------
# Запуск сервера
# ------------------------------
start:
	$(PYTHON) -m uvicorn app.main:app --reload

# ------------------------------
# Поиск и убийство uvicorn
# ------------------------------
stop:
	@pkill -f "uvicorn app.main:app" || true
	@echo "Все процессы uvicorn остановлены."

# ------------------------------
# Перезапуск сервера
# ------------------------------
restart: stop start

# ------------------------------
# Создание тестового пользователя
# ------------------------------
create-user:
	$(PYTHON) -m app.create_test_user

